var SORT_INDEX,THOUSANDS_SEPARATOR=",",DECIMAL_SEPARATOR=".",TableSort=new Class({initialize:function(e,l,s){if(l&&(THOUSANDS_SEPARATOR=l),s&&(DECIMAL_SEPARATOR=s),!(!e.rows||e.rows.length<1||!e.tHead||e.tHead.rows.length<1))for(var a,t,r=null,n=this,l=window.localStorage.getItem("tablesort_"+e.get("id")),c=(l?r=l.split("|"):(s=e.get("data-sort-default"))&&(r=s.split("|")),e.tHead.rows[e.tHead.rows.length-1]),o=0;o<c.cells.length;o++)-1==c.cells[o].className.indexOf("unsortable")&&(a=c.cells[o],(t=new Element("a").addClass("pointer")).innerHTML=a.innerHTML,a.innerHTML="",t.addEvent("click",function(e,l){n.resort(e,l)}.pass([o,a])).inject(a),r&&r[0]==o)&&($(a).addClass("desc"==r[1]?"asc":"desc"),n.resort(r[0],a))},resort:function(e,l){var s=$(l);if(null!=s){var s=s.getParent("tr"),a=s.getParent("table");if(!(null==a||a.tBodies[0].rows.length<2)){SORT_INDEX=e;for(var t,r=0,n="";""==n&&a.tBodies[0].rows[r];)n=a.tBodies[0].rows[r].cells[e].innerHTML.replace(/<[^>]+>/g,"").clean(),r++;for(var c=[],r=0;r<a.tBodies[0].rows.length;r++)c[r]=a.tBodies[0].rows[r];-1!=l.className.indexOf("date")||n.match(/^\d{1,4}[\/\. -]\d{1,2}[\/\. -]\d{1,4}$/)?c.sort(this.sortDate):-1!=l.className.indexOf("currency")||n.match(/^[£$€Û¢´]/)||n.match(/^-?[\d\.,]+[£$€]$/)||-1!=l.className.indexOf("numeric")||n.match(/^-?[\d\.,]+(E[-+][\d]+)?$/)||n.match(/^-?[\d\.,]+%?$/)?c.sort(this.sortNumeric):c.sort(this.sortCaseInsensitive);var o,i=s.getChildren();if(-1==l.className.indexOf("asc")){for(r=0;r<i.length;r++)i[r].removeClass("asc"),i[r].removeClass("desc");l.addClass("asc"),window.localStorage.setItem("tablesort_"+a.id,e+"|asc")}else{for(r=0;r<i.length;r++)i[r].removeClass("asc"),i[r].removeClass("desc");l.addClass("desc"),window.localStorage.setItem("tablesort_"+a.id,e+"|desc"),c.reverse()}for(r=0;r<c.length;r++){for(o=(o=c[r].className).replace(/row_\d+/,"").replace(/odd|even|row_first|row_last/g,"").clean(),o+=" row_"+r,0==r&&(o+=" row_first"),c.length-1<=r&&(o+=" row_last"),o+=r%2==0?" odd":" even",c[r].className=o.trim(),t=0;t<c[r].cells.length;t++)o=(o=c[r].cells[t].className).replace(/col_\d+/,"").replace(/odd|even|col_first|col_last/g,"").clean(),o+=" col_"+t,0==t&&(o+=" col_first"),t>=c[r].cells.length-1&&(o+=" col_last"),c[r].cells[t].className=o.trim();a.tBodies[0].appendChild(c[r])}}}},sortDate:function(e,l){var s,a,e=e.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean(),l=l.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean(),t=e.replace(/[\/\.-]/g," ").split(" "),l=l.replace(/[\/\.-]/g," ").split(" ");return e.match(/^\d{1,2}[\/\. -]\d{1,2}[\/\. -]\d{2,4}$/)&&(s=(4==t[2].length?t[2]:"19"+t[2])+(2==t[1].length?t[1]:"0"+t[1])+(2==t[0].length?t[0]:"0"+t[0]),a=(4==l[2].length?l[2]:"19"+l[2])+(2==l[1].length?l[1]:"0"+l[1])+(2==l[0].length?l[0]:"0"+l[0])),e.match(/^\d{2,4}[\/\. -]\d{1,2}[\/\. -]\d{1,2}$/)&&(s=(4==t[0].length?t[0]:"19"+t[0])+(2==t[1].length?t[1]:"0"+t[1])+(2==t[2].length?t[2]:"0"+t[2]),a=(4==l[0].length?l[0]:"19"+l[0])+(2==l[1].length?l[1]:"0"+l[1])+(2==l[2].length?l[2]:"0"+l[2])),s==a?0:s<a?-1:1},sortNumeric:function(e,l){var s=new RegExp("\\"+THOUSANDS_SEPARATOR,"g"),e=e.cells[SORT_INDEX].innerHTML.replace(s,""),l=l.cells[SORT_INDEX].innerHTML.replace(s,"");return"."!=DECIMAL_SEPARATOR&&(e=e.replace(DECIMAL_SEPARATOR,"."),l=l.replace(DECIMAL_SEPARATOR,".")),e=e.replace(/<[^>]+>/).replace(/[^0-9\.,-]/g,"").clean(),l=l.replace(/<[^>]+>/).replace(/[^0-9\.,-]/g,"").clean(),e=parseFloat(e),isNaN(e)&&(e=0),l=parseFloat(l),e-(l=isNaN(l)?0:l)},sortCaseInsensitive:function(e,l){e=e.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean().toLowerCase(),l=l.cells[SORT_INDEX].innerHTML.replace(/<[^>]+>/g,"").clean().toLowerCase();return e==l?0:e<l?-1:1}});